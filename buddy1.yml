- pipeline: "Test & Deploy"
  trigger_mode: "ON_EVERY_PUSH"
  ref_name: "master"
  ref_type: "BRANCH"
  actions:
  - action: "Execute: npm test"
    type: "BUILD"
    working_directory: "/buddy/unknown-stag"
    docker_image_name: "library/node"
    docker_image_tag: "6"
    execute_commands:
    - "npm install"
    - "npm test"
    - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
    - chmod +x ./cc-test-reporter
    - ./cc-test-reporter after-build --debug
    mount_filesystem_path: "/buddy/unknown-stag"
    shell: "SH"
    trigger_condition: "ALWAYS"
  - action: "Execute: npm run deploy"
    type: "BUILD"
    working_directory: "/buddy/unknown-stag"
    docker_image_name: "library/node"
    docker_image_tag: "6"
    execute_commands:
    - "npm install"
    - "npm run build"
    setup_commands:
    - "npm install -g create-react-app"
    - "npm install -g firebase-tools"
    mount_filesystem_path: "/buddy/unknown-stag"
    shell: "SH"
    trigger_condition: "ALWAYS"
  - action: "Push to Master"
    type: "PUSH"
    disabled: true
    git_auth_mode: "HTTP"
    target_branch: "master"
    push_url: "https://github.com/davehenton/unknown-stag"
    use_custom_gitignore: true
    trigger_condition: "ALWAYS"
  - action: "Send Email notification"
    type: "EMAIL"
    trigger_time: "ON_FAILURE"
    title: "${execution.pipeline.name} execution #${execution.id}"
    content: "The most recent test on unknown-stag failed. "
    recipients: "dave@codeclimate.com"
    trigger_condition: "ALWAYS"
